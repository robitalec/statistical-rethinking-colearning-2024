---
title: "Lecture 06 Notes"
author: "Alec L. Robitaille"
date: "2024-02-22"
---

```{r}
#| include: false
source('R/packages.R')
```

# Causal Thinking

In an experiment, we remove the causes of the treatment by randomizing it

We need a statistical procedure that mimics randomization, that allows us to
transform our sample into results that were as if we could have done that
experiment

We communicate assumptions clearly using DAGs, and use logic to derive the
implications of the causal model

Recall from L05, three common confounds and their implications for the 
relationships between X, Y, and Z: 

![](../graphics/stat_rethinking_l05_four_elemental_xyz.png)

## Example: XYU
```{r}
#| echo: false
coords <- data.frame(
	name = c('X', 'Y', 'U'),
	x =    c(1,    3,   2),
	y =    c(0,    0,   1)
)
```

```{r}
dagify(
	X ~ U,
	Y ~ U + X,
  coords = coords
) |> ggdag(seed = 2, layout = 'auto') + theme_dag()
```

Removing the confound U 

U is a common cause of X and Y. X and Y are associated because of their 
common cause U and we can remove that association by stratifying on U. Then, 
the remaining association after stratifying by U is the association of X and Y.

$$P(Y|do(X)) = \sum_{U}P(Y|X, U)P(U) = E_{U}(Y|X,U)$$

The distribution of Y, stratified by X and U, averaged over the distribution of U. 

The causal effect of X on Y is not the coefficient relating X to Y, it is the
distribution of Y when we change X, averaged over the distributions of the
control variables.


## Example: cheetahs, baboons and gazelles

```{r}
#| echo: false
coords <- data.frame(
	name = c('B', 'G', 'C'),
	x =    c(1,    3,   2),
	y =    c(0,    0,   1)
)
```

```{r}
dagify(
	B ~ C,
	G ~ C + B,
  coords = coords
) |> ggdag(seed = 2, layout = 'auto') + theme_dag()
```


When cheetahs are present, baboons hang out near trees and do not predate on
gazelles. When cheetahs are absent, baboons predate on gazelles. The causal
effect of baboons depends on the distribution of cheetahs.


## do-calculus

do-calculus are the rules for finding $P(Y | do(X))$, that justify graphical
analysis of DAGs and say what is possible.

$P(Y | do(X))$: the distribution of Y, stratified by X and U, averaged over the
distribution of U

DAGs don't make assumptions about functional relationships, they are non-parametric

DAGs allow us to justify if we need to make additional assumptions at all, 
without needing additional assumptions about the functional relationships. 
